{% extends "pos/base.html" %}
{% load static %}
{% load i18n %}

{% block title %}{% trans "Customer Purchase History" %}{% endblock title %}

{% block heading %}{% trans "Customer Purchase History" %}{% endblock heading %}

{% block content %}
<div class="row">
    <div class="col-md-12">
        <div class="card shadow mb-4">
            <div class="card-header py-3">
                <h6 class="m-0 font-weight-bold text-primary">{% trans "Purchase History for" %} {{ customer.get_full_name }} ({% trans "Tax ID" %}: {{ customer.tax_id }})</h6>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-bordered" id="purchaseHistoryTable" width="100%" cellspacing="0">
                        <thead>
                            <tr>
                                <th>{% trans "Sale ID" %}</th>
                                <th>{% trans "Date" %}</th>
                                <th>{% trans "Total (USD)" %}</th>
                                <th>{% trans "Total (VES)" %}</th>
                                <th>{% trans "Payment Method" %}</th>
                                <th>{% trans "Type" %}</th>
                                <th>{% trans "Details" %}</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for sale in sales %}
                            <tr>
                                <td>{{ sale.id }}</td>
                                <td>{{ sale.date_added|date:"DATETIME_FORMAT" }}</td>
                                <td>{{ sale.grand_total|floatformat:2 }} $</td>
                                <td>{{ sale.total_ves|floatformat:2 }} Bs</td>
                                <td>{{ sale.payment_method.name }}</td>
                                <td>{% if sale.is_credit %}{% trans "Credit" %}{% else %}{% trans "Cash" %}{% endif %}</td>
                                <td><a href="{% url 'sales:sales_details' sale.id %}" class="btn btn-info btn-sm">{% trans "View Details" %}</a></td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="7">{% trans "No purchase history found for this customer." %}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock content %}

{% block javascripts %}
<!-- Page level plugins -->
<script src="{% static 'vendor/datatables/jquery.dataTables.min.js' %}"></script>
<script src="{% static 'vendor/datatables/dataTables.bootstrap4.min.js' %}"></script>

<!-- Page level custom scripts -->
<script src="{% static 'js/demo/datatables-demo.js' %}"></script>

<script>
    $(document).ready(function() {
        $('#purchaseHistoryTable').DataTable({
            "order": [[ 1, "desc" ]] // Order by date column (1) descending
        });
    });
</script>
{% endblock javascripts %}
